#! /usr/bin/env bash

if [ "$CI" != "true" ]; then
    read -r -p "ORCID username (leave blank to skip auth tests): " ORCID_USER
    if [ -n "$ORCID_USER" ]; then
        read -r -s -p "ORCID password: " ORCID_PASSWORD
        export ORCID_USER ORCID_PASSWORD
    fi
fi

# RIP firefox

npx testcafe \
    --selector-timeout "${TIMEOUT}" \
    --stop-on-first-fail \
    "chrome --disable-features=LocalNetworkAccessChecks" \
    browse-periods local-database view-authority

# do not run tests in parallel on two different
# browsers, because things get flaky.

npx testcafe \
    --selector-timeout "${TIMEOUT}" \
    --stop-on-first-fail \
    safari \
    browse-periods local-database view-authority
